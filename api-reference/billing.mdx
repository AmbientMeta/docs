---
title: Billing
description: Manage subscriptions, view usage, and access the billing portal
---

## Overview

The billing endpoints let you upgrade your plan, view current usage, and access the Stripe customer portal for self-service billing management. All billing endpoints require authentication via `X-API-Key`.

---

## POST /v1/billing/upgrade

Create a Stripe Checkout session to upgrade to a paid plan.

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `success_url` | string | Yes | URL to redirect to after successful checkout |
| `cancel_url` | string | Yes | URL to redirect to if the user cancels |

### Example Request

```bash
curl -X POST https://api.ambientmeta.com/v1/billing/upgrade \
  -H "X-API-Key: am_live_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "success_url": "https://ambientmeta.com/dashboard?upgraded=true",
    "cancel_url": "https://ambientmeta.com/dashboard/billing"
  }'
```

### Response

| Field | Type | Description |
|-------|------|-------------|
| `checkout_url` | string | Stripe Checkout URL — redirect the user here |

```json
{
  "checkout_url": "https://checkout.stripe.com/c/pay/cs_live_..."
}
```

### Errors

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `invalid_api_key` | 401 | API key is missing or invalid |
| `billing_not_configured` | 400 | Billing is not configured on this instance |
| `no_billing_account` | 400 | No Stripe customer found for this org |
| `billing_error` | 502 | Stripe error — try again |

---

## POST /v1/billing/portal

Create a Stripe Customer Portal session for managing subscriptions, payment methods, and invoices.

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `return_url` | string | Yes | URL to return to after leaving the portal |

### Example Request

```bash
curl -X POST https://api.ambientmeta.com/v1/billing/portal \
  -H "X-API-Key: am_live_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "return_url": "https://ambientmeta.com/dashboard/billing"
  }'
```

### Response

| Field | Type | Description |
|-------|------|-------------|
| `portal_url` | string | Stripe Customer Portal URL — redirect the user here |

```json
{
  "portal_url": "https://billing.stripe.com/p/session/..."
}
```

### Errors

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `invalid_api_key` | 401 | API key is missing or invalid |
| `no_billing_account` | 400 | No Stripe customer found for this org |
| `billing_error` | 502 | Stripe error — try again |

---

## GET /v1/billing/usage

Return the current plan, rate limit, and real-time usage for the authenticated organization.

### Example Request

```bash
curl https://api.ambientmeta.com/v1/billing/usage \
  -H "X-API-Key: am_live_xxx"
```

### Response

| Field | Type | Description |
|-------|------|-------------|
| `org_id` | string | Organization identifier |
| `plan` | string | Current plan: `"free"`, `"pro"`, or `"pro_plus"` |
| `rate_limit` | integer | Requests per minute allowed |
| `requests_this_minute` | integer | Requests used in the current sliding window |
| `subscription_status` | string | Stripe subscription status: `"active"`, `"past_due"`, etc. |

### Example Response

```json
{
  "org_id": "org_a1b2c3d4e5f6",
  "plan": "pro",
  "rate_limit": 600,
  "requests_this_minute": 42,
  "subscription_status": "active"
}
```

### Errors

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `invalid_api_key` | 401 | API key is missing or invalid |
